"undefined"==typeof window.tfpc&&(window.tfpc={}),window.tfpc.metadata={version:"1.0.1",revision:{label:"a75d0b9",hash:"a75d0b9"}},angular.module("configurationApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngRaven","ngResource","ngRoute","ngSanitize","ngTouch","mm.foundation","selectize","xml"]).config(["$httpProvider","$ravenProvider","$routeProvider",function(a,b,c){a.interceptors.push("xmlHttpInterceptor"),c.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).when("/configuration/server",{templateUrl:"views/configuration/server.html",controller:"ServerController"}).when("/configuration/accounts",{templateUrl:"views/configuration/accounts.html",controller:"AccountsController",reloadOnSearch:!1}).when("/configuration/rules",{templateUrl:"views/configuration/rules.html",controller:"RulesController"}).when("/connect",{templateUrl:"views/connect.html",controller:"ConnectController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutController"}).otherwise({redirectTo:"/"})}]).run(["Authentication","RavenTags","$location","$rootScope",function(a,b,c,d){d.$m=window.tfpc.metadata;var e=window.tfpc.metadata;b.update({application_version:e.version,application_revision:e.revision.label}),d.$r={path:null,search:null,redirect:function(){null!==this.path?c.path(this.path):c.path("/"),null!==this.search?c.search(this.search):c.search("")}},d.$on("$routeChangeStart",function(b,e){var f=e.controller;"LoginController"!==f&&(a.authenticated()||(e.resolve=angular.extend(e.resolve||{},{__authenticate__:function(){a.get().then(function(){console.log("authenticated")},function(){d.$r.path=c.path(),d.$r.search=c.search(),c.path("/login"),c.search("")})}})),"ConnectController"!==f&&(null===d.$s||"undefined"==typeof d.$s)&&(d.$r.path=c.path(),d.$r.search=c.search(),c.path("/connect"),c.search("")))})}]),angular.module("configurationApp").controller("AccountsController",["Account","$location","$q","$rootScope","$routeParams","$scope",function(a,b,c,d,e,f){function g(a){return a=parseInt(a),null===a||isNaN(a)?(f.account=null,c.reject()):(f.account=f.accounts[a],f.accountRefresh())}function h(){return"undefined"!=typeof e.id?g(e.id):(b.search("id",Object.keys(f.accounts)[0]),c.resolve())}f.accounts={},f.account=null,f.accountRefresh=function(){return f.account.refresh(d.$s)},f.accountDiscard=function(){return f.account.discard()},f.accountSave=function(){return f.account.save(d.$s)},f.create=function(a){return null===a||""===a?c.reject("Name is required"):d.$s.call("account.create",[],{name:a}).then(function(){f.refresh()},function(a){return null===a||"string"!=typeof a.message?c.reject("Unknown error"):c.reject(a.message)})},f.refresh=function(){return d.$s.call("account.list",[],{full:!0}).then(function(b){return f.accounts=_.indexBy(_.map(_.filter(b,function(a){return a.id>0}),function(b){return new a(b)}),function(a){return a.id}),h()},function(){return c.reject()})},f.refresh(),f.$on("$routeUpdate",function(){h()})}]),angular.module("configurationApp").controller("ServerController",["Options","$q","$rootScope","$scope",function(a,b,c,d){d.options=null,d.refresh=function(){return c.$s.call("option.list",[]).then(function(b){d.options=new a(b)},function(){return b.reject()})},d.discard=function(){return d.options.discard()},d.save=function(){return d.options.save(c.$s)},d.refresh()}]),angular.module("configurationApp").controller("RulesController",["ClientRuleCollection","UserRuleCollection","$q","$rootScope","$scope",function(a,b,c,d,e){e.client=new a,e.user=new b,$(".rules table").sortable({handle:"a.move",containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',onDragStart:function(a,b,c){var d=a[0],e=d.parentNode,f=Array.prototype.indexOf.call(e.children,a[0]);a.addClass(b.group.options.draggedClass),$("body").addClass(b.group.options.bodyClass),a.data("drag-from",f)},onDrop:function(a,b,c){var d=a[0],f=d.parentNode,g=a.data("drag-from"),h=Array.prototype.indexOf.call(f.children,a[0]);a.removeClass(b.group.options.draggedClass).removeAttr("style"),$("body").removeClass(b.group.options.bodyClass);var i=a.parents("table"),j=i.data("collection"),k=null;if("client"===j)k=e.client;else{if("user"!==j)return void console.warn('Unable to find collection with the name "%s"',j);k=e.user}var l=k.rules[g];return"undefined"==typeof l?void console.warn("Unable to retrieve item with index %s",g):(k.rules.splice(g,1),k.rules.splice(h,0,l),k.updatePriorities(),void e.$apply())}}),e.refresh=function(){var a=[d.$s.call("account.list").then(function(a){a=_.filter(a,function(a){return a.id>0}),a=_.map(a,function(a){return{$order:10,type:"name",value:a.id,text:a.name}}),e.client.updateAccounts(a),e.user.updateAccounts(a)},function(){return c.reject("Unable to retrieve accounts")}),e.client.refresh(),e.user.refresh()];return c.all(a)},e.attributeLabel=function(a){return null===a||"*"===a?"Any":"@"===a?"Map":a},e.refresh()}]),angular.module("configurationApp").controller("ConnectController",["Server","RavenTags","CSystem","PAPI","SConnection","$location","$rootScope","$scope",function(a,b,c,d,e,f,g,h){h.state="",h.selected=null,h.servers=[],d.resources(!0).success(function(b){var c=_.filter(b.MediaContainer.Device,function(a){return"server"===a._provides});h.servers=_.map(c,function(b){return a.fromElement(b)}),console.log(h.servers)}),h.select=function(a){a.connect().then(function(){console.log("Connection successful"),a.authenticate().then(function(){console.log("Authentication successful"),g.$s=a,b.update({plugin_version:a.plugin_version}),h.$r.redirect()},function(){console.warn("Authentication failed"),h.state=""})},function(){console.warn("Unable to find valid connection"),h.state=""}),h.state="connecting",h.selected=a}}]),angular.module("configurationApp").controller("FooterController",["$scope",function(a){a.connectionVisible=!1,a.versionVisible=!1,a.toggleConnection=function(){a.connectionVisible=!a.connectionVisible},a.toggleVersion=function(){a.versionVisible=!a.versionVisible}}]),angular.module("configurationApp").controller("HomeController",["$location",function(a){a.path("/configuration/server"),a.search("")}]),angular.module("configurationApp").controller("LoginController",["Authentication","$location","$modal","$scope",function(a,b,c,d){d.credentials={username:null,password:null},d.submit=function(){a.login(d.credentials).then(function(){d.$r.redirect()},function(){console.log("login error")})},d.showAuthenticationDetails=function(){var a=c.open({templateUrl:"modals/authenticationDetails.html",windowClass:"small"});a.result.then(function(){console.log("Modal closed")},function(){console.log("Modal dismissed")})}}]),angular.module("configurationApp").controller("LogoutController",["Authentication","$location",function(a,b){a.logout(),b.path("/login"),b.search("")}]),angular.module("configurationApp").factory("Differ",function(){function a(b,c){var d={};return _.each(b,function(b,e){c[e]!==b&&(_.isObject(b)&&(b=a(b,c[e]),0===Object.keys(b).length)||(d[e]=b))}),d}return{run:a}}),angular.module("configurationApp").directive("coAuthenticationPlex",function(){return{restrict:"E",scope:{authorization:"=coAuthorization"},templateUrl:"directives/authentication/plex.html"}}),angular.module("configurationApp").directive("coAuthenticationTrakt",function(){return{restrict:"E",scope:{authorization:"=coAuthorization"},templateUrl:"directives/authentication/trakt.html"}}),angular.module("configurationApp").directive("coConfigurationGroup",function(){return{restrict:"E",scope:{groups:"=coGroups"},templateUrl:"directives/configuration/group.html"}}),angular.module("configurationApp").directive("coConfigurationHeader",function(){return{restrict:"E",scope:{title:"=coTitle",self:"=coSelf",refresh:"=coRefresh",discard:"=coDiscard",save:"=coSave"},templateUrl:"directives/configuration/header.html"}}),angular.module("configurationApp").directive("coConfigurationOption",function(){return{restrict:"E",scope:{option:"="},template:'<ng-include src="getTemplateUrl()"/>',controller:["$scope",function(a){var b="directives/configuration/option/",c={"boolean":"boolean.html","enum":"enum.html",integer:"integer.html",string:"string.html"};a.getTemplateUrl=function(){return b+c[a.option.type]},a.parseKey=function(a){return"null"===a?null:parseInt(a,10)}}]}}),angular.module("configurationApp").directive("coButton",function(){return{restrict:"E",scope:{self:"=coSelf",callback:"=coCallback","class":"@coClass",tooltip:"@coTooltip"},templateUrl:"directives/button.html",transclude:!0,controller:["$scope",function(a){a.call=function(){return"undefined"==typeof a.self||null===a.self?a.callback():$.proxy(a.callback,a.self)()},a.click=function(){a.button.start(),a.call().then(function(){a.button.stop()},function(){a.button.stop()})}}],link:function(a,b){var c=$("button",b);c.addClass(a["class"]).addClass("ladda-button"),"secondary"===a["class"]&&c.attr("data-spinner-color","#333333"),a.button=Ladda.create(c[0])}}}),angular.module("configurationApp").directive("coButtonInput",["$timeout",function(a){return{restrict:"E",scope:{callback:"=coCallback",placeholder:"@coPlaceholder",tooltip:"@coTooltip"},templateUrl:"directives/button-input.html",transclude:!0,controller:["$scope",function(b){b.opened=!1,b.value=null,b.click=function(){return b.opened?(b.button.start(),void b.callback(b.value).then(function(){b.close(),b.button.stop()},function(a){b.error=a,b.button.stop()})):void b.open()},b.open=function(){b.opened=!0,a(function(){b.input.focus()},100)},b.close=function(){b.error=null,b.opened=!1,b.value=null},b.keyup=function(a){13===a.keyCode?b.click():27===a.keyCode&&b.close()}}],link:function(a,b){a.button=Ladda.create($("button",b)[0]),a.input=$("input",b)}}}]),angular.module("configurationApp").factory("ClientRuleCollection",["ClientRule","$q","$rootScope","$timeout",function(a,b,c,d){function e(){this.available={keys:null,names:null,addresses:null},this.accounts=null,this.accountsById=null,this.original=null,this.rules=null}var f=[{$order:1,value:"-",text:"None"}],g=[{$order:1,value:"*",text:"Any"}];return e.prototype.create=function(){this.reset();var b=new a(this,{key:"*",name:"*",address:"*",account:{id:"-",name:"None"},priority:this.rules.length+1},"edit");this.rules.push(b),d(function(){b.focus()})},e.prototype["delete"]=function(a){var b=this.rules.indexOf(a);-1!==b&&(this.rules.splice(b,1),this.updatePriorities())},e.prototype.discard=function(){return this.updateRules(this.original),this.updatePriorities(),b.resolve()},e.prototype.refresh=function(){var a=this;return b.all([c.$s.call("session.client.list").then($.proxy(a.updateClients,a),function(){return b.reject("Unable to retrieve clients")}),c.$s.call("session.client.rule.list",[],{full:!0}).then($.proxy(a.updateRules,a),function(){return b.reject("Unable to retrieve client rules")})])},e.prototype.reset=function(){_.each(this.rules,function(a){a.save()})},e.prototype.save=function(){var a=this,d=_.map(this.rules,function(a){return a.current()});return c.$s.call("session.client.rule.update",[],{current:d,full:!0}).then($.proxy(a.updateRules,a),function(){return b.reject("Unable to update client rules")})},e.prototype.renderClient=function(a,b){return"key"!==a.type?'<div class="option">'+b(a.text)+"</div>":'<div class="option client"><div class="name">'+b(a.name)+'</div><small class="extra">'+b(a.product)+" / "+b(a.text)+"</small></div>"},e.prototype.updateAccounts=function(a){this.accounts=[].concat(f,a),this.accountsById=_.indexBy(this.accounts,"value")},e.prototype.updateClients=function(a){this.available.keys=[].concat(g,_.map(a,function(a){return{$order:10,type:"key",value:a.key,text:a.key,name:a.name,platform:a.platform,product:a.product}})),this.available.names=[].concat(g,_.map(a,function(a){return{$order:10,type:"name",value:a.name,text:a.name}})),this.available.addresses=[].concat(g,_.map(a,function(a){return{$order:10,type:"address",value:a.address,text:a.address}}))},e.prototype.updatePriorities=function(){for(var a=0;a<this.rules.length;++a)this.rules[a].priority=a+1},e.prototype.updateRules=function(b){var c=this;this.original=angular.copy(b),this.rules=_.map(b,function(b){return new a(c,b)})},e}]),angular.module("configurationApp").factory("ClientRule",function(){function a(a,b,c){this.collection=a,this.id=null,this.key=null,this.name=null,this.address=null,this.account=null,this.priority=null,this.state="undefined"!=typeof c?c:"view",this.update(b)}function b(a){return"@"===a.account_function?{id:"@",name:"Map"}:"undefined"!=typeof a.account&&null!==a.account?a.account:{id:"-",name:"None"}}function c(a){return null===a?"*":a}return a.prototype["delete"]=function(){this.collection["delete"](this)},a.prototype.edit=function(){this.collection.reset(),this.state="edit"},a.prototype.focus=function(){if("undefined"!=typeof this.priority&&null!==this.priority){var a=$(".rules .clients .rule.p-"+this.priority);if(null===a||0===a.length)return void console.warn("Unable to find TR element for rule",this);console.log(a),$("td.account input",a).focus()}},a.prototype.save=function(){this.state="view";var a=this.collection.accountsById[this.account.id];"undefined"==typeof a?this.account.name="None":this.account.name=a.text},a.prototype.current=function(){var a={id:this.id,key:this.key,name:this.name,address:this.address,account:null,account_function:null,priority:this.priority};return"-"===this.account.id?a.account=null:"@"===this.account.id?a.account_function="@":a.account=this.account.id,a},a.prototype.update=function(a){this.original=angular.copy(a),this.id="undefined"!=typeof a.id?a.id:null,this.key=c(a.key),this.name=c(a.name),this.address=c(a.address),this.account=b(a),this.priority=a.priority},a}),angular.module("configurationApp").factory("UserRuleCollection",["UserRule","$q","$rootScope","$timeout",function(a,b,c,d){function e(){this.available={names:null},this.accounts=null,this.accountsById=null,this.original=null,this.rules=null}var f=[{$order:1,value:"-",text:"None"},{$order:2,value:"@",text:"Map"}],g=[{$order:1,value:"*",text:"Any"}];return e.prototype.create=function(){this.reset();var b=new a(this,{name:"*",account:{id:"-",name:"None"},priority:this.rules.length+1},"edit");this.rules.push(b),d(function(){b.focus()})},e.prototype["delete"]=function(a){var b=this.rules.indexOf(a);-1!==b&&(this.rules.splice(b,1),this.updatePriorities())},e.prototype.discard=function(){return this.updateRules(this.original),this.updatePriorities(),b.resolve()},e.prototype.refresh=function(){var a=this;return b.all([c.$s.call("session.user.list").then($.proxy(a.updateUsers,a),function(){return b.reject("Unable to retrieve users")}),c.$s.call("session.user.rule.list",[],{full:!0}).then($.proxy(a.updateRules,a),function(){return b.reject("Unable to retrieve user rules")})])},e.prototype.reset=function(){_.each(this.rules,function(a){a.save()})},e.prototype.save=function(){var a=this,d=_.map(this.rules,function(a){return a.current()});return c.$s.call("session.user.rule.update",[],{current:d,full:!0}).then($.proxy(a.updateRules,a),function(){return b.reject("Unable to update user rules")})},e.prototype.updateAccounts=function(a){this.accounts=[].concat(f,a),this.accountsById=_.indexBy(this.accounts,"value")},e.prototype.updatePriorities=function(){for(var a=0;a<this.rules.length;++a)this.rules[a].priority=a+1},e.prototype.updateRules=function(b){var c=this;this.original=angular.copy(b),this.rules=_.map(b,function(b){return new a(c,b)})},e.prototype.updateUsers=function(a){this.available.names=[].concat(g,_.map(a,function(a){return{$order:10,type:"name",value:a.name,text:a.name}}))},e}]),angular.module("configurationApp").factory("UserRule",function(){function a(a,b,c){this.collection=a,this.id=null,this.name=null,this.account=null,this.priority=null,this.state="undefined"!=typeof c?c:"view",this.update(b)}function b(a){return"@"===a.account_function?{id:"@",name:"Map"}:"undefined"!=typeof a.account&&null!==a.account?a.account:{id:"-",name:"None"}}function c(a){return null===a?"*":a}return a.prototype["delete"]=function(){this.collection["delete"](this)},a.prototype.edit=function(){this.collection.reset(),this.state="edit"},a.prototype.focus=function(){if("undefined"!=typeof this.priority&&null!==this.priority){var a=$(".rules .users .rule.p-"+this.priority);if(null===a||0===a.length)return void console.warn("Unable to find TR element for rule",this);console.log(a),$("td.account input",a).focus()}},a.prototype.save=function(){this.state="view";var a=this.collection.accountsById[this.account.id];"undefined"==typeof a?this.account.name="None":this.account.name=a.text},a.prototype.current=function(){var a={id:this.id,name:this.name,account:null,account_function:null,priority:this.priority};return"-"===this.account.id?a.account=null:"@"===this.account.id?a.account_function="@":a.account=this.account.id,a},a.prototype.update=function(a){this.original=angular.copy(a),this.id="undefined"!=typeof a.id?a.id:null,this.name=c(a.name),this.account=b(a),this.priority=a.priority},a}),angular.module("configurationApp").factory("Account",["AccountAuthentication","Differ","Options","$q",function(a,b,c,d){function e(b){this.authentication=new a,this.options=null,this.id=null,this.name=null,this.thumb_url=null,this.update(b)}var f={plex:{authorization:{basic:{valid:!1}}},trakt:{authorization:{basic:{valid:!1},oauth:{valid:!1}}}};return e.prototype.current=function(){var a=this,b=[this.authentication.plex.current(),this.authentication.trakt.current()];return d.all(b).then(function(b){var c={name:a.name};return _.each(b,function(a){$.extend(!0,c,a)}),c},function(a){return d.reject(a)})},e.prototype.update=function(a){a=$.extend(!0,angular.copy(f),a),this.data=angular.copy(a),this.id=a.id,this.name=a.name,this.thumb_url=a.thumb_url,this.authentication.update(a)},e.prototype.refresh=function(a){var b=this;return d.all([a.call("account.get",[],{full:!0,id:b.id}).then(function(a){b.update(a)}),a.call("option.list",[],{account:b.id}).then(function(a){b.options=new c(a,b)})])},e.prototype.discard=function(){return this.update(this.data),this.options.discard()},e.prototype.save=function(a){var b=this;return d.all([this.current().then(function(c){return a.call("account.update",[],{id:b.id,data:c}).then(function(a){b.update(a)},function(){return d.reject()})},function(){return d.reject()}),this.options.save(a)])},e}]),angular.module("configurationApp").factory("AccountAuthentication",["PUsers","$q",function(a,b){function c(){this.data=null,this.id=null,this.username=null,this.authorization=null,this.valid=!1}function d(){this.data=null,this.id=null,this.username=null,this.authorization=null,this.valid=!1}function e(){this.plex=new c,this.trakt=new d,this.valid=!1}var f=new trakt.Client("c9ccd3684988a7862a8542ae0000535e0fbd2d1c0ca35583af7ea4e784650a61","bf00575b1ad252b514f14b2c6171fe650d474091daad5eb6fa890ef24d581f65");return c.prototype.basicChanged=function(){var a=this.authorization.basic,b=this.data.authorization.basic;return a.username!==b.username?!0:a.password!==b.password?!0:!1},c.prototype.current=function(){if(!this.basicChanged())return b.resolve({});var c=this.authorization.basic,d=b.defer();return a.sign_in({username:c.username,password:c.password}).success(function(a){var b=a.user;d.resolve({plex:{username:b.username,authorization:{basic:{token:b._authenticationToken}}}})}).error(function(){d.reject()}),d.promise},c.prototype.update=function(a){this.data=angular.copy(a),this.id=a.id,this.username=a.username,this.authorization=a.authorization,this.valid=!1},c.prototype.validate=function(){this.valid=this.authorization.basic.valid},d.prototype.basicChanged=function(){var a=this.authorization.basic,b=this.data.authorization.basic;return a.username!==b.username?!0:a.password!==b.password?!0:!1},d.prototype.oauthChanged=function(){var a=this.authorization.oauth,b=this.data.authorization.oauth;return a.code!==b.code?!0:!1},d.prototype.current=function(){var a=[];if(this.basicChanged()){var c=this.authorization.basic,d=this.data.authorization.basic,e={trakt:{username:c.username}};c.password!==d.password&&(e.trakt.authorization={basic:{password:c.password}}),a.push(b.when(e))}if(this.oauthChanged()){var g=this.authorization.oauth.code;a.push(f.oauth.token(g).then(function(a){return{trakt:{authorization:{oauth:$.extend(a,{code:g})}}}},function(){return b.reject()}))}return b.all(a).then(function(a){var b={};return _.each(a,function(a){$.extend(!0,b,a)}),b},function(){return b.reject()})},d.prototype.update=function(a){this.data=angular.copy(a),this.id=a.id,this.username=a.username,this.authorization=a.authorization,this.valid=!1},d.prototype.validate=function(){this.valid=this.authorization.basic.valid||this.authorization.oauth.valid},e.prototype.update=function(a){this.plex.update(a.plex),this.trakt.update(a.trakt),this.validate()},e.prototype.validate=function(){this.plex.validate(),this.trakt.validate(),this.valid=this.plex.valid&&this.trakt.valid},e}]),angular.module("configurationApp").factory("Connection",["$http",function(a){function b(){this.uri=null}return b.prototype.request=function(b,c){return c.url=this.uri+"/"+b,a(c)},b.fromElement=function(a){var c=new b;return c.uri=a._uri,c},b}]),angular.module("configurationApp").factory("Options",["$q",function(a){function b(a,c,d){d="undefined"!=typeof d?d:0;for(var e=0;e<c.length;++e){var f=c[e],g=f.group[d],h=a[g];"undefined"==typeof h&&(h=a[g]={name:g,groups:{},enabled:null,options:[]}),f.group.length-d===1?f.key.endsWith(".enabled")&&"boolean"===f.type?h.enabled=f:h.options.push(f):b(h.groups,[f],d+1)}}function c(a,c){this.current=a,this.account="undefined"!=typeof c?c:null,this.original=angular.copy(a),this.groups={},b(this.groups,a)}return c.prototype.discard=function(){for(var b=0;b<this.current.length;++b){var c=this.current[b],d=this.original[b];c.value=d.value}return a.resolve()},c.prototype.save=function(b){for(var c=this,d={},e=0;e<this.current.length;++e){var f=this.current[e],g=this.original[e];d[f.key]={from:g.value,to:f.value}}return b.call("option.update",[],{changes:d,account:null!==this.account?this.account.id:null}).then(function(a){var b=_.object(_.map(a.updated,function(a){return[a,!0]}));_.each(c.original,function(a,d){"undefined"!=typeof b[a.key]&&(a.value=c.current[d].value)})},function(b){return a.reject(b)})},c}]),angular.module("configurationApp").factory("Server",["Connection","CSystem","PMessaging","SConnection","$q",function(a,b,c,d,e){function f(){this.name=null,this.identifier=null,this.plugin_version=null,this.token_channel=null,this.token_channel_expire=null,this.token_plex=null,this.connections=null,this.current=null,this.error=null}function g(a){if("undefined"==typeof a||null===a)return null;var b=a.indexOf("-");-1!==b&&(a=a.substr(0,b));var c=a.split(".");return c=c.splice(0,3),c.join(".")}var h="com.plexapp.plugins.trakttv",i=">=0.9.10",j="MessageKit:Api";return f.prototype.isAuthenticated=function(){return null===this.token_channel?!1:!0},f.prototype.authenticate=function(){var a=this;return b.authenticate(this).then(function(){a.save()},function(b){return a.error=b,e.reject()})},f.prototype.connect=function(){var a=this;return a.error=null,d.test(this).then(function(b){return a.check().then(function(){return b},function(b){return a.error=b,e.reject(b)})},function(b){return a.error={message:b},e.reject(a.error)})},f.prototype.check=function(){var a=this;return b.ping(this).then(function(b){a.plugin_version=b.version;var c=g(b.version);return semver.satisfies(c,i)?!0:e.reject({message:"Plugin update required"})},function(a){return e.reject(a)})},f.prototype.call=function(a,b,d){b="undefined"!=typeof b?b:[],b.splice(0,0,a);var e={};return null!==this.token_channel&&(e["X-Channel-Token"]=this.token_channel),console.debug('[%s] Request "%s"',this.identifier,a,{args:b,kwargs:d}),c.call(this,h,j,b,d,e)},f.prototype.get=function(a,b){return b="undefined"!=typeof b?b:{},b.method="GET",b.headers="undefined"!=typeof b.headers?b.headers:{},b.headers["X-Plex-Token"]=this.token_plex,this.current.request(a,b)},f.prototype._attributeKey=function(a){return"server."+this.identifier+"."+a},f.prototype.load=function(){function a(a){var c=localStorage[b._attributeKey(a)];null!==c&&"undefined"!=typeof c&&(b[a]=c)}if(null!==this.identifier&&"undefined"!=typeof this.identifier){var b=this;a("token_plex"),a("token_channel"),a("token_channel_expire")}},f.prototype.save=function(){function a(a){localStorage[b._attributeKey(a)]=b[a]}if(null!==this.identifier&&"undefined"!=typeof this.identifier){var b=this;a("token_plex"),a("token_channel"),a("token_channel_expire")}},f.fromElement=function(b){var c=new f;return c.name=b._name,c.identifier=b._clientIdentifier,c.token_plex=b._accessToken,"undefined"==typeof b.Connection.length&&(b.Connection=[b.Connection]),c.connections=_.map(b.Connection,function(b){return a.fromElement(b)}),c.load(),c},f}]),angular.module("configurationApp").factory("CSystem",["$q",function(a){return{authenticate:function(b){return b.isAuthenticated()?a.resolve(!0):b.call("system.authenticate",[b.token_plex]).then(function(c){return null==c["X-Channel-Token"]||null==c["X-Channel-Token-Expire"]?a.reject(null):(b.token_channel=c["X-Channel-Token"],b.token_channel_expire=c["X-Channel-Token-Expire"],!0)},function(b){return a.reject(b)})},ping:function(a){return a.call("system.ping")}}}]),angular.module("configurationApp").factory("PAPI",["Authentication","PHeaders","$http",function(a,b,c){return{resources:function(d){return c({method:"GET",url:"https://plex.tv/api/resources",params:{includeHttps:d?1:0},headers:$.extend(b.get(),{"X-Plex-Token":a.token()})})}}}]),angular.module("configurationApp").factory("PUsers",["PHeaders","$http","$q",function(a,b,c){return{sign_in:function(d){var e=c.defer();return null==d||null==d.username||null==d.password?(e.reject(),e.promise):b({method:"POST",url:"https://plex.tv/users/sign_in.xml",headers:$.extend(a.get(),{Authorization:"Basic "+btoa(d.username+":"+d.password)})})},account:function(c){return b({method:"GET",url:"https://plex.tv/users/account",headers:$.extend(a.get(),{"X-Plex-Token":c})})}}}]),angular.module("configurationApp").factory("PHeaders",function(){var a=new UAParser,b=a.getResult();null==localStorage["plex.client.identifier"]&&(localStorage["plex.client.identifier"]=Math.random().toString(36).substr(2));var c={"X-Plex-Client-Identifier":localStorage["plex.client.identifier"],"X-Plex-Device":b.os.name,"X-Plex-Device-Name":"trakt (for Plex) - Configuration ("+b.browser.name+")","X-Plex-Platform":b.browser.name,"X-Plex-Platform-Version":b.browser.version.split(".").slice(0,2).join("."),"X-Plex-Product":"trakt (for Plex)","X-Plex-Version":"1.0.0"};return{get:function(){return angular.copy(c)}}}),angular.module("configurationApp").factory("PMessaging",["$q",function(a){function b(a,b,c){c="undefined"!=typeof c?c:[];var d=":/plugins/"+a+"/messaging/"+b;return c.length>0&&(d+="/"+c.join("/")),d}function c(a){var b;return b=cerealizer.dumps(a),b=e(b),b=encodeURIComponent(b)}function d(a){var b;return b=decodeURIComponent(a),b=f(b),cerealizer.loads(b)}function e(a){return btoa(a).replace(/\//g,"@").replace(/\+/g,"*").replace(/\=/g,"_")}function f(a){a=a.replace(/\@/g,"/").replace(/\*/g,"+").replace(/\_/g,"=");var b=a.length%4;return b>0&&(a+=g("=",4-b)),atob(a)}function g(a,b){for(var c="";b-->0;)c+=a;return c}return{call:function(f,g,h,i,j,k){i="undefined"!=typeof i?i:[],j="undefined"!=typeof j?j:{};var l=b(g,"function",[e(h),c(i),c(j)]),m={headers:k};return f.get(l,m).then(function(b){var c=d(b.data);return"string"==typeof c?c=JSON.parse(c):"object"==typeof c&&console.warn("Legacy response format returned"),console.debug("[%s] Response",f.identifier,c),void 0!==c.result?c.result:void 0!==c.error?a.reject(c.error):null},function(b){return a.reject({message:b.status+" - "+b.statusText})})}}}]),angular.module("configurationApp").factory("RavenTags",function(){var a={};return{update:function(b){_.each(b,function(b,c){a[c]=b}),Raven.setTagsContext(a)}}}),angular.module("configurationApp").factory("SConnection",["PHeaders","$http","$q",function(a,b,c){return{test:function(a){function b(){var c=e.shift();return null==c?void d.reject("Unable to find valid connection"):void f.testConnection(c,a).then(function(a){d.resolve(a)},function(){b()})}console.debug("[%s] Testing %s connections",a.identifier,a.connections.length);var d=c.defer(),e=angular.copy(a.connections),f=this;return b(),d.promise},testConnection:function(d,e){console.debug("[%s] Testing connection: %s",e.identifier,d.uri);var f=c.defer(),g=b({method:"GET",url:d.uri+"/identity",headers:$.extend(a.get(),{"X-Plex-Token":e.token_plex})});return g.success(function(a){var b=a.MediaContainer._machineIdentifier;return b!==e.identifier?(console.debug("Connection identifier %s doesn't match server identifier %s",b,e._clientIdentifier),void f.reject()):(console.log("[%s] Using connection: %s",e.identifier,d.uri),e.current=d,void f.resolve(d))}).error(function(){f.reject()}),f.promise}}}]),angular.module("configurationApp").factory("Authentication",["PUsers","RavenTags","$http","$q","$rootScope",function(a,b,c,d,e){function f(a,b){e.$a={authenticated:"undefined"!=typeof a?a:!1,user:"undefined"!=typeof b?b:null},e.$a.authenticated||(e.$s=null)}var g="MLawOtoMiFf5Ni9nbu0bTes2+UkrVLMZ8LSPwA+qTtA=",h=/^server\.\w+\.((token_channel)|(token_channel_expire)|(token_plex))$/,i=null;return f(),{authenticated:function(){return null!==i},user:function(a){return void 0!==a?(i=a,null!==a?b.update({user_identifier:"undefined"!=typeof i.username?md5(i.username+g):null}):b.update({user_identifier:null}),a):i},token:function(a){return void 0===a?localStorage["plex.token"]:(null===a?delete localStorage["plex.token"]:localStorage["plex.token"]=a,a)},login:function(b){var c=d.defer(),e=this;return null===b||null===b.username||null===b.password?(c.reject(),c.promise):(a.sign_in(b).success(function(a){e.token(a.user._authenticationToken),e.user(a.user),f(!0,a.user),c.resolve(a.user)}).error(function(){f(),c.reject()}),c.promise)},logout:function(){this.token(null),this.user(null);for(var a=[],b=0;b<localStorage.length;++b){var c=localStorage.key(b);null!==h.exec(c)&&a.push(c)}_.each(a,function(a){delete localStorage[a]}),f()},get:function(){var b=d.defer(),c=this,e=c.token(),g=c.user();return"undefined"==typeof e||null===e?(b.reject(),b.promise):null!==g?(b.resolve(g),b.promise):(a.account(e).success(function(a){c.user(a.user),f(!0,a.user),b.resolve(a.user)}).error(function(){f(),b.reject()}),b.promise)}}}]),angular.module("configurationApp").run(["$templateCache",function(a){"use strict";a.put("views/configuration/accounts.html",'<div class="accounts small-12 large-9 large-centered columns"> <div class="list small-4 columns"> <ul class="panel side-nav"> <li ng-repeat="a in accounts" ng-class="{active: account.id == a.id}"> <a href="#/configuration/accounts?id={{ a.id }}"> <img class="avatar" ng-src="{{ a.thumb_url }}">{{ a.name }} </a> </li> </ul> <div class="actions"> <div class="actions-left"> <co-button co-class="secondary" co-tooltip="Refresh accounts" co-callback="refresh"> <i class="fi-refresh"></i> </co-button> </div> <div class="actions-right"> <co-button-input class="create" co-placeholder="Name" co-tooltip="Create account" co-callback="create"> <i class="fi-plus"></i> </co-button-input> </div> </div> </div> <div class="options small-8 columns"> <co-configuration-header class="row" co-title="account.name" co-refresh="accountRefresh" co-discard="accountDiscard" co-save="accountSave"> </co-configuration-header> <div class="authentication group" ng-show="account"> <div class="row header"> <div class="small-8 large-10 columns"> <h5>Authentication</h5> </div> </div> <tabset> <tab heading="Trakt" data-valid="{{ account.authentication.trakt.valid }}"> <co-authentication-trakt co-authorization="account.authentication.trakt.authorization"></co-authentication-trakt> </tab> <tab heading="Plex" data-valid="{{ account.authentication.plex.valid }}"> <co-authentication-plex co-authorization="account.authentication.plex.authorization"></co-authentication-plex> </tab> </tabset> </div> <co-configuration-group co-groups="account.options.groups"></co-configuration-group> </div> </div>'),
a.put("views/configuration/rules.html",'<div class="rules large-9 large-centered columns"> <div class="clients large-12"> <co-configuration-header class="row" co-title="\'Client Rules\'" co-self="client" co-refresh="client.refresh" co-discard="client.discard" co-save="client.save"> </co-configuration-header> <table cellspacing="0" data-collection="client"> <thead> <tr> <th class="actions"></th> <th class="account">Account</th> <th class="machine-identifier">Client</th> <th class="name">Name</th> <th class="address">Address</th> </tr> </thead> <tbody> <tr class="rule p-{{ rule.priority }}" ng-repeat="rule in client.rules track by $index" ng-class="{edit: rule.state == \'edit\'}"> <td class="actions" ng-switch on="rule.state"> <div ng-switch-when="edit"> <a title="Delete" ng-click="rule.delete()"><i class="fi-x"></i></a> <a title="Save" ng-click="rule.save()"><i class="fi-save"></i></a> </div> <div ng-switch-default> <a title="Move" class="move"><i class="fa fa-arrows-v"></i></a> <a title="Delete" ng-click="rule.delete()"><i class="fi-x"></i></a> <a title="Edit" ng-click="rule.edit()"><i class="fi-wrench"></i></a> </div> </td> <td class="account" ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'name\', label: \'Accounts\'}\n                  ]\n                }" options="client.accounts" ng-model="rule.account.id"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ rule.account.name }} </div> </td> <td class="machine-identifier" ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  create: true,\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'key\', label: \'Clients\'}\n                  ],\n                  render: {\n                    option: client.renderClient\n                  }\n                }" options="client.available.keys" ng-model="rule.key"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ attributeLabel(rule.key) }} </div> </td> <td ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  create: true,\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'name\', label: \'Names\'}\n                  ]\n                }" options="client.available.names" ng-model="rule.name"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ attributeLabel(rule.name) }} </div> </td> <td ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  create: true,\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'address\', label: \'IP Addresses\'}\n                  ]\n                }" options="client.available.addresses" ng-model="rule.address"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ attributeLabel(rule.address) }} </div> </td> </tr> </tbody> <tfoot> <tr class="new"> <td class="actions"> <a title="New" ng-click="client.create()"><i class="fi-plus"></i></a> </td> </tr> </tfoot> </table> </div> <div class="users large-12"> <co-configuration-header class="row" co-title="\'User Rules\'" co-self="user" co-refresh="user.refresh" co-discard="user.discard" co-save="user.save"> </co-configuration-header> <table cellspacing="0" data-collection="user"> <thead> <tr> <th class="actions"></th> <th class="account">Account</th> <th style="width: 220px">Name</th> <th style="width: auto"></th> </tr> </thead> <tbody> <tr class="rule p-{{ rule.priority }}" ng-repeat="rule in user.rules track by $index" ng-class="{edit: rule.state == \'edit\'}"> <td class="actions" ng-switch on="rule.state"> <div ng-switch-when="edit"> <a title="Delete" ng-click="rule.delete()"><i class="fi-x"></i></a> <a title="Save" ng-click="rule.save()"><i class="fi-save"></i></a> </div> <div ng-switch-default> <a title="Move" class="move"><i class="fa fa-arrows-v"></i></a> <a title="Delete" ng-click="rule.delete()"><i class="fi-x"></i></a> <a title="Edit" ng-click="rule.edit()"><i class="fi-wrench"></i></a> </div> </td> <td class="account" ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'name\', label: \'Accounts\'}\n                  ]\n                }" options="user.accounts" ng-model="rule.account.id"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ rule.account.name }} </div> </td> <td ng-switch on="rule.state"> <div class="wrapper edit" ng-switch-when="edit"> <selectize config="{\n                  create: true,\n                  optgroupField: \'type\',\n                  optgroupValueField: \'type\',\n                  maxItems: 1,\n                  optgroups: [\n                    {type: \'name\', label: \'Names\'}\n                  ]\n                }" options="user.available.names" ng-model="rule.name"> </selectize> </div> <div class="wrapper plain" ng-switch-default> {{ attributeLabel(rule.name) }} </div> </td> <td style="width: auto"></td> </tr> </tbody> <tfoot> <tr class="new"> <td class="actions"> <a title="New" ng-click="user.create()"><i class="fi-plus"></i></a> </td> </tr> </tfoot> </table> </div> </div>'),a.put("views/configuration/server.html",'<div class="options small-12 small-centered large-6 large-centered columns"> <co-configuration-header class="row" co-title="$s.name" co-refresh="refresh" co-discard="discard" co-save="save"> </co-configuration-header> <co-configuration-group co-groups="options.groups"></co-configuration-group> </div>'),a.put("views/connect.html",'<div class="connect panel small-10 small-centered large-3 large-centered columns" ng-switch="state"> <div class="header"> <h5>Connect</h5> </div> <div class="servers" ng-switch-default> <div class="row server" ng-repeat="server in servers" ng-click="select(server)"> <div class="name small-12">{{ server.name }}</div> <div class="error small-12" ng-show="server.error">{{ server.error.message }}</div> </div> </div> <div class="status" ng-switch-when="connecting"> <div class="busy"><div class="spinner"></div></div> </div> </div>'),a.put("views/home.html",""),a.put("views/login.html",'<div class="login panel"> <div class="header"> <h5>Login to plex.tv</h5> <div class="help"> <a class="details" ng-click="showAuthenticationDetails()" title="Authentication details"> <i class="fa fa-question-circle"></i> </a> </div> </div> <form> <div class="row"> <label>Username <input type="text" ng-model="credentials.username"> </label> <label>Password <input type="password" ng-model="credentials.password"> </label> <input class="button small" type="submit" value="Sign in" ng-click="submit()"> </div> </form> </div>'),a.put("views/logout.html","")}]);